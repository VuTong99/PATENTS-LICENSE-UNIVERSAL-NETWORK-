<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üì∏ Gallery ‚Äî LICENSE G·ªêC‚Ñ¢</title>

<style>
/* ====== Theme Tokens (Dark/Light + Gold) ====== */
:root{
  --bg:#0a0b0f;
  --panel:#0f1117;
  --ink:#eae7dc;
  --muted:#a8b3c7;
  --line:rgba(255, 215, 0, .25);

  /* 24K gold-ish */
  --gold:#ffd700;         /* base */
  --gold2:#f5d36a;        /* highlight */
  --gold3:#b6862e;        /* shadow */

  --radius:14px;
  --thumb:240px;          /* thumbnail width (slider ƒëi·ªÅu ch·ªânh) */
  --gap:16px;
  --shadow:0 6px 24px rgba(0,0,0,.35);
  --glow:0 0 18px rgba(255,215,0,.35);
}

/* Light mode override */
.theme-light{
  --bg:#f1f4fb;
  --panel:#ffffff;
  --ink:#181a1f;
  --muted:#475069;
  --line:rgba(204, 164, 0, .25);
  --shadow:0 6px 22px rgba(0,0,0,.10);
  --glow:0 0 14px rgba(204,164,0,.35);
}

/* Transition m∆∞·ª£t khi ƒë·ªïi theme */
html, body, .wrap, .toolbar, .card, .viewer{
  transition: background .45s ease, color .45s ease, border-color .45s ease, box-shadow .45s ease;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--ink);
  font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
  background:
    radial-gradient(1200px 600px at 10% -10%, rgba(255,215,0,.08), transparent 60%),
    radial-gradient(1000px 600px at 110% 110%, rgba(255,215,0,.06), transparent 60%),
    var(--bg);
}

/* ====== Header ====== */
header{
  position:sticky; top:0; z-index:10;
  background:linear-gradient(to bottom, rgba(0,0,0,.35), transparent), var(--bg);
  padding:22px 16px 10px;
  border-bottom:1px solid var(--line);
  backdrop-filter:saturate(140%) blur(6px);
}
.title{
  display:flex; align-items:center; gap:10px; margin:0 0 6px;
  font-weight:800; letter-spacing:.3px;
  color:var(--gold3);
  text-shadow: 0 1px 0 rgba(0,0,0,.2), 0 0 14px rgba(255,215,0,.25);
}
.title span{
  font-size: clamp(20px, 3.6vw, 32px);
  background:linear-gradient(180deg, var(--gold), var(--gold2) 55%, var(--gold3));
  -webkit-background-clip:text; background-clip:text; color:transparent;
}
.title .dot{ width:10px; height:10px; border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, var(--gold) 45%, var(--gold3) 80%);
  box-shadow: var(--glow);
}

/* ====== Toolbar ====== */
.toolbar{
  display:flex; flex-wrap:wrap; gap:10px; align-items:center;
  padding:10px 8px 12px;
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.toolbar > *{margin-right:6px}
label{font-size:13px; color:var(--muted)}

.btn{
  appearance:none; border:1px solid var(--line);
  padding:8px 12px; border-radius:10px;
  background:linear-gradient(180deg, rgba(255,215,0,.18), rgba(255,215,0,.08));
  color:var(--ink); cursor:pointer; font-weight:600;
}
.btn:hover{ box-shadow:var(--glow) }
.switch{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border:1px solid var(--line);
  border-radius:12px; cursor:pointer; user-select:none;
  background:var(--panel);
}
.switch input{appearance:none; width:38px; height:22px; border-radius:11px; background:#7774; position:relative; outline:none}
.switch input::after{
  content:""; position:absolute; inset:3px; width:16px; height:16px; border-radius:50%; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.35);
  transform:translateX(0); transition:transform .25s ease;
}
.switch input:checked{background:#ffdf80aa}
.switch input:checked::after{ transform:translateX(16px) }

/* ====== Grid ====== */
.wrap{max-width:1200px; margin:14px auto; padding:0 14px}
.grid{
  display:grid; grid-template-columns:repeat(auto-fill, minmax(var(--thumb), 1fr));
  gap:var(--gap);
}
.card{
  background:linear-gradient(180deg, rgba(255,215,0,.05), transparent 30%), var(--panel);
  border:1px solid var(--line);
  border-radius:var(--radius); overflow:hidden;
  box-shadow:var(--shadow);
  transition: transform .18s ease, box-shadow .18s ease;
}
.card:hover{ transform:translateY(-2px); box-shadow:0 10px 32px rgba(0,0,0,.45) }
.thumb{
  width:100%; height:220px; object-fit:cover; display:block; background:#0a0f18;
  filter: var(--filter, none);
}
.meta{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 12px;
  border-top:1px dashed var(--line);
}
.name{ font-size:12px; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.actions{ display:flex; gap:8px }
.icon{
  border:none; background:transparent; cursor:pointer; font-size:18px; line-height:1;
  filter: drop-shadow(0 0 2px rgba(0,0,0,.35));
}
a.icon{ text-decoration:none }

/* ====== Viewer (Lightbox) ====== */
.viewer{
  position:fixed; inset:0; z-index:50; display:none;
  background:rgba(0,0,0,.75);
  align-items:center; justify-content:center; padding:24px;
}
.viewer.open{ display:flex }
.box{
  width:min(96vw, 1200px); max-height:90vh;
  background:var(--panel); border:1px solid var(--line); border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,.6); overflow:hidden; display:flex; flex-direction:column;
}
.stage{
  position:relative; display:flex; align-items:center; justify-content:center;
  background:#000; min-height:50vh;
}
.stage img, .stage video{
  max-width:100%; max-height:70vh; object-fit:contain;
  filter: var(--filter, none);
}
.vbar{
  display:flex; flex-wrap:wrap; gap:12px; align-items:center; padding:12px; background:linear-gradient(180deg, rgba(255,215,0,.05), transparent), var(--panel);
  border-top:1px solid var(--line);
}
.vbar .grow{ flex:1 }
.vbar select, .vbar input[type="range"]{
  accent-color:#d4af37; cursor:pointer;
}
.vtitle{ font-weight:700; color:var(--gold3) }

/* nice range */
input[type="range"]{ width:140px }

/* ====== Small utility ====== */
.hidden{ display:none !important }
footer{ text-align:center; color:var(--muted); padding:18px 0 30px; font-size:13px }
.kbd{padding:2px 6px; border:1px solid var(--line); border-radius:6px; font:12px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
</style>
</head>

<body>
  <header>
    <div class="wrap">
      <h1 class="title">
        <i class="dot"></i>
        <span>Gallery ‚Äî LICENSE G·ªêC‚Ñ¢</span>
      </h1>

      <div class="toolbar" role="group" aria-label="controls">
        <label class="switch">
          <input id="themeToggle" type="checkbox" />
          <span>Dark ‚Üî Light</span>
        </label>

        <label>Size:
          <input id="sizeRange" type="range" min="160" max="360" step="10" value="240">
        </label>

        <label>Preset:
          <select id="preset">
            <option value="none">‚Ä¢ None</option>
            <option value="golden">Golden</option>
            <option value="noir">Noir</option>
            <option value="dream">Dream</option>
            <option value="cinema">Cinema</option>
          </select>
        </label>

        <label>Bright
          <input id="rBright" type="range" min="0.5" max="1.6" step="0.02" value="1">
        </label>
        <label>Contrast
          <input id="rContrast" type="range" min="0.6" max="1.6" step="0.02" value="1">
        </label>
        <label>Satur.
          <input id="rSatur" type="range" min="0" max="2" step="0.02" value="1">
        </label>
        <label>Blur
          <input id="rBlur" type="range" min="0" max="6" step="0.1" value="0">
        </label>

        <button id="resetFilters" class="btn">Reset Filters</button>
        <div class="grow"></div>
        <span class="hint" style="font-size:12px;color:var(--muted)">
          ‚å®Ô∏è <span class="kbd">‚Üê</span> <span class="kbd">‚Üí</span> ƒëi·ªÅu h∆∞·ªõng ‚Ä¢ <span class="kbd">Esc</span> tho√°t
        </span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <p class="hint" id="status">ƒêang t·∫£i danh s√°ch‚Ä¶</p>
    <section id="grid" class="grid hidden" aria-live="polite"></section>
  </main>

  <footer>¬© 2025 LICENSE G·ªêC‚Ñ¢ ‚Äî Gallery module</footer>

  <!-- ====== Lightbox Viewer ====== -->
  <div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-label="Preview">
    <div class="box">
      <div class="stage" id="stage"></div>
      <div class="vbar">
        <div class="vtitle" id="vname">‚Äî</div>
        <div class="grow"></div>
        <a id="openOriginal" class="btn" target="_blank" rel="noopener">Open original</a>
        <a id="download" class="btn" download>Download</a>
        <button id="close" class="btn">Close</button>
      </div>
    </div>
  </div>

<script>
/* ===========================================================
   GOC GALLERY ‚Äì ·∫£nh, video, lightbox, filters, theme
   Y√™u c·∫ßu: /assets/list.txt  (m·ªói d√≤ng: t√™n file, v√≠ d·ª• IMG_7242.png)
   =========================================================== */
const LIST_URL = 'assets/list.txt';
const ASSET_BASE = 'assets/';
const grid = document.getElementById('grid');
const statusEl = document.getElementById('status');

const themeToggle = document.getElementById('themeToggle');
const sizeRange   = document.getElementById('sizeRange');
const presetSel   = document.getElementById('preset');
const rBright     = document.getElementById('rBright');
const rContrast   = document.getElementById('rContrast');
const rSatur      = document.getElementById('rSatur');
const rBlur       = document.getElementById('rBlur');
const resetBtn    = document.getElementById('resetFilters');

const viewer      = document.getElementById('viewer');
const stage       = document.getElementById('stage');
const vname       = document.getElementById('vname');
const openOriginal= document.getElementById('openOriginal');
const downloadBtn = document.getElementById('download');
const closeBtn    = document.getElementById('close');

let items = [];           // [{name, url, type:'image'|'video'}]
let current = -1;         // index ƒëang xem

/* ---------- Theme state ---------- */
(function initTheme(){
  const saved = localStorage.getItem('goc.gallery.theme') || 'dark';
  document.body.classList.toggle('theme-light', saved==='light');
  themeToggle.checked = (saved==='light');
})();
themeToggle.addEventListener('change', ()=>{
  const light = themeToggle.checked;
  document.body.classList.toggle('theme-light', light);
  // hi·ªáu ·ª©ng ‚Äúb·∫≠t s√°ng‚Äù nh·∫π
  document.body.animate([{filter:'brightness(1.05)'},{filter:'brightness(1)'}], {duration:500, easing:'ease'});
  localStorage.setItem('goc.gallery.theme', light?'light':'dark');
});

/* ---------- Thumb size ---------- */
(function initSize(){
  const saved = localStorage.getItem('goc.gallery.thumb');
  if(saved){ sizeRange.value = saved }
  document.documentElement.style.setProperty('--thumb', sizeRange.value+'px');
})();
sizeRange.addEventListener('input', ()=>{
  document.documentElement.style.setProperty('--thumb', sizeRange.value+'px');
  localStorage.setItem('goc.gallery.thumb', sizeRange.value);
});

/* ---------- Filters (√°p d·ª•ng c·∫£ Grid & Viewer) ---------- */
function currentFilter(){
  const b = parseFloat(rBright.value);
  const c = parseFloat(rContrast.value);
  const s = parseFloat(rSatur.value);
  const blur = parseFloat(rBlur.value);
  return `brightness(${b}) contrast(${c}) saturate(${s}) blur(${blur}px)`;
}
function applyFilter(){
  const f = currentFilter();
  document.querySelectorAll('.thumb, .stage img, .stage video').forEach(el=>{
    el.style.filter = f;
  });
}
[rBright, rContrast, rSatur, rBlur].forEach(inp=> inp.addEventListener('input', applyFilter));
resetBtn.addEventListener('click', ()=>{
  presetSel.value='none';
  rBright.value=1; rContrast.value=1; rSatur.value=1; rBlur.value=0;
  applyFilter();
});
presetSel.addEventListener('change', ()=>{
  const p = presetSel.value;
  if(p==='golden'){ rBright.value=1.06; rContrast.value=1.08; rSatur.value=1.25; rBlur.value=0.2; }
  else if(p==='noir'){ rBright.value=1.0; rContrast.value=1.30; rSatur.value=0; rBlur.value=0; }
  else if(p==='dream'){ rBright.value=1.15; rContrast.value=0.95; rSatur.value=1.1; rBlur.value=1.2; }
  else if(p==='cinema'){ rBright.value=1.05; rContrast.value=1.18; rSatur.value=1.05; rBlur.value=0; }
  else { rBright.value=1; rContrast.value=1; rSatur.value=1; rBlur.value=0; }
  applyFilter();
});

/* ---------- Load list.txt ---------- */
async function fetchList(){
  const res = await fetch(LIST_URL, {cache:'no-store'});
  if(!res.ok) throw new Error('Kh√¥ng t√¨m th·∫•y assets/list.txt');
  const text = await res.text();
  const names = text.split(/\r?\n/).map(s=>s.trim()).filter(s=>s && !s.startsWith('#'));
  items = names.map(name=>{
    const url = ASSET_BASE + name;
    const ext = name.split('.').pop().toLowerCase();
    const isVideo = ['mp4','webm','ogg','mov'].includes(ext);
    return {name, url, type: isVideo?'video':'image'};
  });
  if(items.length===0) throw new Error('list.txt tr·ªëng ‚Äì th√™m t√™n file m·ªói d√≤ng');
}

/* ---------- Render Grid ---------- */
function cardTpl(item, idx){
  const open = `data-open="${idx}"`;
  if(item.type==='image'){
    return `
      <article class="card">
        <img class="thumb" src="${item.url}" alt="${item.name}" loading="lazy" ${open}/>
        <div class="meta">
          <div class="name" title="${item.name}">${item.name}</div>
          <div class="actions">
            <a class="icon" href="${item.url}" target="_blank" title="Open original" rel="noopener">üîó</a>
            <a class="icon" href="${item.url}" download title="Download">‚¨áÔ∏è</a>
            <button class="icon" ${open} title="Preview">üîç</button>
          </div>
        </div>
      </article>
    `;
  }else{
    // video thumbnail = ch√≠nh video (muted) ‚Äì auto-paused
    return `
      <article class="card">
        <video class="thumb" preload="metadata" ${open} muted playsinline>
          <source src="${item.url}" type="video/${item.url.split('.').pop()}"/>
        </video>
        <div class="meta">
          <div class="name" title="${item.name}">${item.name}</div>
          <div class="actions">
            <a class="icon" href="${item.url}" target="_blank" title="Open original" rel="noopener">üîó</a>
            <a class="icon" href="${item.url}" download title="Download">‚¨áÔ∏è</a>
            <button class="icon" ${open} title="Preview">‚ñ∂Ô∏è</button>
          </div>
        </div>
      </article>
    `;
  }
}
function render(){
  grid.innerHTML = items.map(cardTpl).join('');
  grid.classList.remove('hidden');
  statusEl.textContent = `ƒê√£ t·∫£i ${items.length} m·ª•c. Nh·∫•n ·∫£nh/bi·ªÉu t∆∞·ª£ng ƒë·ªÉ xem.`;
  applyFilter();
}

/* ---------- Viewer (Lightbox) ---------- */
function openViewer(idx){
  current = idx;
  const it = items[current];
  stage.innerHTML = '';
  let node;
  if(it.type==='image'){
    node = new Image();
    node.src = it.url; node.alt = it.name; node.loading = 'eager';
  }else{
    node = document.createElement('video');
    node.src = it.url; node.controls = true; node.autoplay = true; node.playsInline = true;
  }
  stage.appendChild(node);
  vname.textContent = it.name;
  openOriginal.href = it.url;
  downloadBtn.href = it.url;
  downloadBtn.setAttribute('download', it.name);
  viewer.classList.add('open');
  applyFilter();
}
function closeViewer(){ viewer.classList.remove('open'); stage.innerHTML=''; current=-1; }
function step(dir){
  if(current<0) return;
  const next = (current + dir + items.length) % items.length;
  openViewer(next);
}

/* Delegation: click v√†o grid / n√∫t */
grid.addEventListener('click', (e)=>{
  const el = e.target.closest('[data-open]');
  if(!el) return;
  openViewer( parseInt(el.dataset.open,10) );
});
closeBtn.addEventListener('click', closeViewer);
viewer.addEventListener('click', (e)=>{ if(e.target===viewer) closeViewer(); });

/* Keyboard */
document.addEventListener('keydown', (e)=>{
  if(!viewer.classList.contains('open')) return;
  if(e.key==='Escape') closeViewer();
  if(e.key==='ArrowLeft') step(-1);
  if(e.key==='ArrowRight') step(1);
});

/* ---------- Boot ---------- */
(async function boot(){
  try{
    await fetchList();
    render();
  }catch(err){
    statusEl.style.color = '#ff6961';
    statusEl.innerHTML = 'L·ªói: ' + err.message +
      '<br>H√£y t·∫°o <b>assets/list.txt</b> (m·ªói d√≤ng 1 t√™n file) v√† th·ª≠ l·∫°i.';
  }
})();
</script>
</body>
</html>
