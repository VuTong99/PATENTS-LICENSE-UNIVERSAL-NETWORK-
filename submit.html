<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Submit • LICENSE GỐC™</title>
<meta name="description" content="Submit ideas, works, patents, and projects to LICENSE GỐC™" />
<style>
  :root{ --bg:#0a0b0f; --panel:#111; --muted:#b7b3a3; --text:#eae7dc; --gold:#f5d36a; --line:rgba(245,211,106,.28); --radius:16px; }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:980px;margin:28px auto 120px;padding:0 16px}
  h1{font-size:clamp(28px,4.5vw,40px);margin:8px 0 6px}
  .muted{color:#cfc8b0}
  .card{background:linear-gradient(180deg,#0f1116,#0a0c10);border:1px solid var(--line);border-radius:18px;box-shadow:0 10px 28px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04); padding:16px}
  .grid{display:grid;gap:14px}
  .grid2{display:grid;gap:14px;grid-template-columns:1fr 1fr}
  label{font-weight:700;color:#ffd54d;margin:2px 0 6px;display:block}
  input,textarea,select{width:100%;background:#0c0e12;border:1px solid rgba(255,255,255,.08);border-radius:12px;color:var(--text);padding:12px 12px;font-size:15px}
  textarea{min-height:140px;resize:vertical}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .btn{padding:11px 16px;border-radius:12px;border:1px solid rgba(229,200,107,.35);background:linear-gradient(180deg,#171a22,#0d1016);color:#ffd54d;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:999px;border:1px solid var(--line);background:#0f1116}
  .meta{display:flex;gap:10px;flex-wrap:wrap}
  .kpi{font-weight:800;color:#ffd54d}
  .preview{white-space:pre-wrap;background:#0b0d11;border:1px dashed var(--line);border-radius:12px;padding:12px;min-height:80px}
  footer{color:#aaa;text-align:center;padding:24px 12px;border-top:1px solid rgba(255,255,255,.06);margin-top:28px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="meta">
      <span class="pill">📦 <b>Submit Center</b></span>
      <span class="pill">🔐 Status: <b id="vaultStatus">Signed out</b></span>
      <span class="pill">🆔 Submission ID: <span class="kpi" id="subId">—</span></span>
      <span class="pill">💾 Auto‑saved</span>
    </div>

    <h1>Submit your Work / Idea</h1>
    <div class="muted">Điền thông tin bên dưới. Mọi dữ liệu được <b>auto‑save</b> cục bộ (localStorage). Nếu đã “Sign in” ở Vault, tên & email sẽ tự điền.</div>

    <div class="card" style="margin-top:14px">
      <div class="grid2">
        <div>
          <label>Your name</label>
          <input id="name" placeholder="Họ & tên">
        </div>
        <div>
          <label>Email</label>
          <input id="email" placeholder="Email dùng làm ID">
        </div>
      </div>

      <div class="grid" style="margin-top:8px">
        <div>
          <label>Title</label>
          <input id="title" placeholder="Tên tác phẩm / ý tưởng">
        </div>
        <div>
          <label>Category</label>
          <select id="category">
            <option value="">— Select —</option>
            <option>Art & Design</option>
            <option>Film & Music</option>
            <option>Science & Tech</option>
            <option>Culture & Language</option>
            <option>Education</option>
            <option>Other</option>
          </select>
        </div>
        <div>
          <label>Description / Abstract</label>
          <textarea id="desc" placeholder="Mô tả ngắn gọn, mục tiêu, tính mới, tác động..."></textarea>
        </div>
        <div>
          <label>Tags (comma separated)</label>
          <input id="tags" placeholder="copyright, patent, AI, culture...">
        </div>
        <div>
          <label>Links / References</label>
          <textarea id="links" placeholder="Link drive, github, figma, video..."></textarea>
        </div>
        <div>
          <label>Attachments (optional)</label>
          <input id="files" type="file" multiple />
          <div class="muted" style="font-size:13px;margin-top:6px">* Demo: file không upload lên server, chỉ đính kèm tên file vào bản lưu.</div>
        </div>
      </div>

      <div class="row" style="margin-top:14px">
        <button class="btn" id="submitBtn">Submit</button>
        <button class="btn" id="exportBtn">Export JSON</button>
        <button class="btn ghost" id="resetBtn">Reset</button>
      </div>
    </div>

    <h3 style="margin:18px 0 8px">Quick Preview</h3>
    <div class="preview" id="previewBox">—</div>

    <footer>© 2025 LICENSE GỐC™ — The Root. Eternal. Universal.</footer>
  </div>

  <script>
  // ===== Helpers: Vault user & LCN wallet key =====
  function getUser(){
    try{ return JSON.parse(localStorage.getItem('goc_user')) }catch(e){ return null }
  }
  function uidFromEmail(email){
    return (email||'').toLowerCase().trim().replace(/[^a-z0-9]+/g,'_').replace(/^_|_$/g,'')
  }
  function balanceKey(uid){ return `lcn_balance_${uid}` }

  // ===== Draft autosave =====
  const draftKey = 'submit_draft_v1'
  const $ = (id)=>document.getElementById(id)
  const fields = ['name','email','title','category','desc','tags','links']

  function readForm(){
    const o={}
    fields.forEach(k=>o[k]=($(k).value||'').trim())
    // attach list of filenames only (demo)
    o.files = Array.from($('files').files||[]).map(f=>f.name)
    return o
  }
  function writeForm(o={}){
    fields.forEach(k=>{ if(o[k]!==undefined) $(k).value=o[k] })
  }
  function saveDraft(){
    const d = readForm()
    d.submissionId = $('subId').textContent
    localStorage.setItem(draftKey, JSON.stringify(d))
    renderPreview()
  }
  function loadDraft(){
    try{
      const d = JSON.parse(localStorage.getItem(draftKey))
      if(d){ writeForm(d); if(d.submissionId) $('subId').textContent = d.submissionId }
    }catch(e){}
  }
  function renderPreview(){
    const d = readForm()
    const id = $('subId').textContent
    $('previewBox').textContent =
`# ${d.title||'(no title)'}
by ${d.name||'—'} | ${d.email||'—'}
ID: ${id}

Category: ${d.category||'—'}
Tags: ${d.tags||'—'}

${d.desc||'—'}

Links:
${d.links||'—'}

Files: ${(d.files||[]).join(', ') || '—'}
`
  }

  // ===== Init: pull from Vault if present =====
  (function init(){
    // Submission ID
    if(!$('subId').textContent || $('subId').textContent==='—'){
      $('subId').textContent = 'SUB_' + Math.random().toString(36).slice(2,8).toUpperCase()
    }

    // Prefill from Vault
    const u = getUser()
    if(u){
      $('vaultStatus').textContent = `Signed in as ${u.name} (${u.email})`
      if(!$('name').value)  $('name').value  = u.name||''
      if(!$('email').value) $('email').value = u.email||''
    }else{
      $('vaultStatus').textContent = 'Signed out'
    }

    // Load draft, then render
    loadDraft()
    renderPreview()

    // Listen & autosave (debounced)
    let t
    ;[...fields.map(id=>$(id)), $('files')].forEach(el=>{
      el.addEventListener('input', ()=>{ clearTimeout(t); t=setTimeout(saveDraft, 300) })
      el.addEventListener('change', ()=>{ clearTimeout(t); t=setTimeout(saveDraft, 300) })
    })

    // Buttons
    $('exportBtn').onclick = ()=>{
      const data = { submissionId:$('subId').textContent, ...readForm(), ts:new Date().toISOString() }
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a'); a.href=url; a.download=`${data.submissionId}.json`; a.click()
      URL.revokeObjectURL(url)
    }

    $('resetBtn').onclick = ()=>{
      localStorage.removeItem(draftKey)
      fields.forEach(id=>$(id).value='')
      $('files').value = ''
      renderPreview()
    }

    // Submit: save “last submission” + (optional) bonus coin
    $('submitBtn').onclick = ()=>{
      const d = { submissionId:$('subId').textContent, ...readForm(), ts:new Date().toISOString() }
      localStorage.setItem('submit_last', JSON.stringify(d))
      // OPTIONAL: bonus +20 LCN if user signed in
      const user = getUser()
      if(user && user.email){
        const uid = uidFromEmail(user.email)
        const key = balanceKey(uid)
        const cur = parseInt(localStorage.getItem(key)||'0',10)||0
        localStorage.setItem(key, String(cur+20))
      }
      alert('✅ Submitted locally!\n• Draft & last submission saved in your browser.\n• If signed in, +20 LCN bonus was added.')
    }
  })();
  </script>

  <!-- Global UI: Floating Bar + Translate + AI Tim -->
  <script src="goc-ui.js"></script>
</body>
</html>
